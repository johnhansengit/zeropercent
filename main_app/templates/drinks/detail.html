{% extends 'base.html' %}
{% block content %}

{% load custom_filters %}

<h1>drink list</h1>

  <div class="card">
    <div class="card-content">
        <div class="card-img">
            <img src="{{ drink.img }}" alt="">
        </div>
        <div class="card-text">
            <span class="card-title">{{ drink.name }}</span>
            <p>Category: {{ drink.category }}</p>
            <p>Ingredients:</p>
              <ul class="ingredient-list">
                {% for ingredient in drink.ingredients|split:"," %}
                <li>{{ ingredient }}</li>
                {% endfor %}
              </ul>
            {% if drink.instructions %}  
            <p>Instructions: {{ drink.instructions|linebreaks }}</p>
            {% endif %}
            <p>Difficulty: {{ drink.get_difficulty_display }}</p>
            <p>Prep Time: {{ drink.prep|convert_to_hours_minutes }}</p>
        </div>
    </div>
    <div class="card-action">
      <a href="{% url 'drinks_update' drink.id %}">Edit</a>
      <a href="{% url 'drinks_delete' drink.id %}">Delete</a>
    </div>
  </div>

  <div class="card">
    <div class="reviews-container">
      <h3>reviews</h3>
      <form action="{% url 'add_review' drink.id %}" method="POST">
        {% csrf_token %}
        {{ review_form.as_p }}
        <input type="submit" class="btn" value="add a review">
      </form>
      {% if drink.review_set.exists %}
        <table class="striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>Reviewer</th>
              <th>Stars</th>
              <th>Review</th>
            </tr>
          </thead>
          <tbody>
            {% for review in drink.review_set.all %}
              <tr>
                <td>{{ review.date}}</td>
                <td>{{ review.reviewer}}</td>
                <td>{{ review.get_stars_display }}</td>
                <td>{{ review.review }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>

<script>
  const selectEl = document.getElementById('id_stars');
  M.FormSelect.init(selectEl);
</script>

{% endblock %}