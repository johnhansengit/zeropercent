{% extends 'base.html' %}
{% block content %}

{% load custom_filters %}

<h1>recipe list</h1>

  <div class="card">
    <div class="card-content">
        <div class="card-img">
            <img src="{{ recipe.img }}" alt="">
        </div>
        <div class="card-text">
            <span class="card-title">{{ recipe.name }}</span>
            <p>Category: {{ recipe.category }}</p>
            <p>Ingredients:</p>
              <ul class="ingredient-list">
                {% for ingredient in recipe.ingredients|split:"," %}
                <li>{{ ingredient }}</li>
                {% endfor %}
              </ul>
            {% if recipe.instructions %}  
            <p>Instructions: {{ recipe.instructions|linebreaks }}</p>
            {% endif %}
            <p>Difficulty: {{ recipe.get_difficulty_display }}</p>
            <p>Prep Time: {{ recipe.prep|convert_to_hours_minutes }}</p>
        </div>
    </div>
    <div class="card-action">
      <a href="{% url 'recipes_update' recipe.id %}">Edit <i class="material-icons">edit</i></a>
      <a href="{% url 'recipes_delete' recipe.id %}">Delete <i class="material-icons">delete</i></a>
    </div>
  </div>

  <div class="card">
    <div class="reviews-container">
      <h3>reviews</h3>
      <form action="{% url 'add_review' recipe.id %}" method="POST">
        {% csrf_token %}
        {{ review_form.as_p }}
        <input type="submit" class="btn" value="add a review">
      </form>
      {% if recipe.review_set.exists %}
        <table class="striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>Reviewer</th>
              <th>Stars</th>
              <th>Review</th>
            </tr>
          </thead>
          <tbody>
            {% for review in recipe.review_set.all %}
              <tr>
                <td>{{ review.date}}</td>
                <td>{{ review.reviewer}}</td>
                <td>{{ review.get_stars_display }}</td>
                <td>{{ review.review }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>

<script>
  const selectEl = document.getElementById('id_stars');
  M.FormSelect.init(selectEl);
</script>

{% endblock %}